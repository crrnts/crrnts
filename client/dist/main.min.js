/*! Trrnts 24-07-2014 */

angular.module("trrntsApp",["ui.router","trrntsApp.main"]).config(["$stateProvider",function(a){a.state("trrntsApp",{template:"<ui-view></ui-view>"})}]).run(["$state",function(a){a.transitionTo("trrntsApp.main")}]),angular.module("trrntsApp.controllers",[]).controller("LatestMagnetLinksController",["$scope","MagnetLinksFactory","SharedService",function(a,b,c){a.perPage=10,a.start=0,a.stop=a.start+a.perPage-1,a.busy=!1,a.latest=[],a.openModal=function(a){c.prepForBroadcast(a)},a.loadMore=function(){a.busy||(a.busy=!0,b.latest(a.start,a.stop).then(function(b){a.latest=a.latest.concat(b.data),a.start+=a.perPage,a.stop+=a.perPage,a.busy=!1}))}}]).controller("BoxOfficeController",["$scope","$sce","MagnetLinksFactory",function(a,b,c){a.html="Waiting for Box Office Top Ten ...",c.topTen().then(function(b){a.html=b})}]).controller("TopMagnetLinksController",["$scope","MagnetLinksFactory","SharedService",function(a,b,c){a.perPage=10,a.start=0,a.stop=a.start+a.perPage-1,a.busy=!1,a.top=[],a.openModal=function(a){c.prepForBroadcast(a)},a.loadMore=function(){a.busy||(a.busy=!0,b.top(a.start,a.stop).then(function(b){a.top=a.top.concat(b.data),a.start+=a.perPage,a.stop+=a.perPage,a.busy=!1}))}}]).controller("SearchBoxController",["$scope","$state",function(a,b){a.search=function(){b.go("trrntsApp.main.search",{query:a.query})}}]).controller("SearchResultsController",["$scope","$stateParams","MagnetLinksFactory","SharedService",function(a,b,c,d){a.results=[],a.query=b.query,a.openModal=function(a){d.prepForBroadcast(a)},c.search(a.query).then(function(b){a.results=b.data})}]).controller("WorldMapController",["$scope","GeoFactory",function(a,b){a.latAndLong={},a.countries={},a.cities={},a.numberOfCountries=15,a.numberOfLatAndLongs=100,a.numberOfCities=10,a.gotLL=!1,a.gotCountries=!1,a.gotCities=!1,a.getLatAndLong=function(c){b.getLatAndLong(c).then(function(b){a.latAndLong=b.data,a.gotLL=!0}).catch(function(a){console.log(a)})},a.getCountries=function(c){b.getCountries(c).then(function(b){a.countries=b.data,a.gotCountries=!0}).catch(function(a){console.log(a)})},a.getCities=function(c){b.getCities(c).then(function(b){a.cities=b.data,a.gotCities=!0}).catch(function(a){console.log(a)})},a.getLatAndLong(a.numberOfLatAndLongs),a.getCountries(a.numberOfCountries),a.getCities(a.numberOfCities)}]).controller("BillboardViewController",["$scope","BillboardDataFactory",function(a,b){a.dummyData=b.getData()}]).controller("ModalViewController",["$scope","SharedService","$location","$state",function(a,b){a.modalShown=!0,console.log("Here"),a.selectedMagnet=b.selectedMagnet}]),angular.module("trrntsApp.directives",[]).directive("counter",function(){return{restrict:"A",link:function(a,b,c){var d=parseInt(c.max),e=0;b=b[0],e=-2,d>100&&(e=d-100);var f=function(){g(),e+=1,b.textContent=e,d>e&&setTimeout(f,1)},g=function(){var a=e/1e3;.2>a&&(a=.2),a>1&&(a=.6),b.style.color="rgba(0, 0, 0, "+a+")"};f()}}}).directive("barChart",function(){return{restrict:"A",link:function(a,b,c){if(void 0!==a.selectedMagnet){b=b[0];for(var d=c.barWidth||20,e=c.barSpace||1,f=c.barChartHeight||70,g=$(b).width(),h=c.highlightHeightDiff||20,i=a.selectedMagnet.peers||{},j=d3.select(b),k=Math.floor(g/(d+e)),l=[],m=0;m<i.length;m+=2)l.unshift({peers:parseInt(i[m]),t:parseInt(i[m+1])});i=l.reverse(),i=i.slice(0,k),i=i.reverse();var n=d3.scale.linear().domain([0,d3.max(i,function(a){return a.peers})]).range([0,f-h]),o=d3.tip().attr("class","d3-tip").offset([-h-10,0]).html(function(a){return"<strong>"+a.peers+"</strong> peers <span>"+moment(parseInt(a.t)).fromNow()+"</span>"});j.call(o);var p=d3.select(b).selectAll("rect").data(i);p.enter().append("rect").attr("class","bar").attr("width",d).attr("x",function(a,b){return d*b+e*b}).attr("y",f).attr("height",0).transition().duration(300).ease("elastic").delay(function(a,b){return.7*b*30}).attr("y",function(a){return f-n(a.peers)}).attr("height",function(a){return n(a.peers)}),p.on("mouseover",function(a,b){p.filter(function(a,c){return c===b}).transition().ease("bounce").attr("y",function(){return f-n(a.peers)-h}).attr("height",function(){return n(a.peers)+h});o.show(a)}),p.on("mouseleave",function(a,b){p.filter(function(a,c){return c===b}).transition().ease("bounce").attr("y",function(a){return f-n(a.peers)}).attr("height",function(a){return n(a.peers)});o.hide(a)})}}}}).directive("worldMap",function(){return{restrict:"A",link:function(a,b){var c=function(a){var b=[],c=0;for(var e in a)parseInt(a[e])>c&&(c=parseInt(a[e]));for(e in a){var f={fillKey:"torrents",radius:d(50,c,a[e]),torrentsTotal:a[e]},g=e.split(",");f.latitude=g[0],f.longitude=g[1],g.length>1&&"?"!==g[0]&&"?"!==g[1]&&b.push(f)}return b},d=function(a,b,c){return Math.floor(c/b*a)},e=new Datamap({element:b[0],fills:{defaultFill:"#ccc",torrents:"#222"}}),f=c(a.latAndLong);e.bubbles(f,{popupTemplate:function(a,b){return'<div class="hoverinfo"> Total Number of Torrents: <strong>'+b.torrentsTotal+"</strong></div>"}})}}}).directive("modalDialog",["$state","$timeout",function(a,b){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(c,d,e){c.animation="ng-modal-dialog-slide-in",c.dialogStyle={},e.width&&(c.dialogStyle.width=e.width),e.height&&(c.dialogStyle.height=e.height),c.hideModal=function(){c.animation="ng-modal-dialog-slide-out",a.go("^"),b(function(){c.show=!1},1003)}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><!--div class='ng-modal-close' ng-click='hideModal()'>X</div--><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}]).directive("donutChart",function(){return{restrict:"A",link:function(a,b,c){b=b[0];var d=[],e=a[c.donutType];if("object"==typeof e)for(var f in e)"?"!==f&&d.push({label:f,value:e[f]});var g=d3.tip().attr("class","d3-tip").offset([-30,0]).html(function(a){return"<div>Total Number of Torrents: <strong> "+a.value+"</strong></div>"}),h=c.donutRadius||200,i=2*h,j=2*h,k=i/2,l=i/3,m=d3.layout.pie().sort(null).value(function(a){return a.value||a}),n=d3.svg.arc().outerRadius(k).innerRadius(l),o=d3.select(b).attr("width",i).attr("height",j).append("g").attr("transform","translate(0,"+j/6+")"),p=d3.scale.category20(),q=o.selectAll("g.arc").data(m(d)).enter().append("g").attr("class","arc").attr("transform","translate("+k+","+l+")").call(g);q.append("path").attr("fill",function(a,b){return p(b)}).attr("d",n),q.append("text").attr("transform",function(a){return"translate("+n.centroid(a)+")"}).attr("text-anchor","middle").text(function(a){return a.data.label}),q.on("mouseover",g.show),q.on("mouseleave",g.hide)}}}),angular.module("trrntsApp.filters",[]).filter("agoFilter",function(){return function(a){return a=parseInt(a),moment(a).fromNow()}}),angular.module("trrntsApp.main",["trrntsApp.controllers","trrntsApp.services","trrntsApp.directives","trrntsApp.filters","nvd3ChartDirectives","infinite-scroll"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise(""),a.state("trrntsApp.main",{url:"",views:{"":{templateUrl:"views/main.tpl.html",controller:["$state",function(a){""===a.current.url&&a.go("trrntsApp.main.top")}]},"searchMagnets@trrntsApp.main":{templateUrl:"views/searchMagnets.tpl.html",controller:"SearchMagnetLinksController"}}}).state("trrntsApp.main.top",{url:"/top",templateUrl:"views/topMagnets.tpl.html",controller:"TopMagnetLinksController"}).state("trrntsApp.main.latest",{url:"/latest",templateUrl:"views/latestMagnets.tpl.html",controller:"TopMagnetLinksController"}).state("trrntsApp.main.stats",{url:"/stats",templateUrl:"views/worldMap.tpl.html",controller:"WorldMapController"}).state("trrntsApp.main.about",{url:"/about",templateUrl:"views/about.tpl.html"}).state("trrntsApp.main.search",{url:"/search?query",templateUrl:"views/searchMagnets.tpl.html",controller:"SearchResultsController"}).state("trrntsApp.main.top.detail",{url:"/detail",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"}).state("trrntsApp.main.latest.detail",{url:"/detail/:magnetName",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"}).state("trrntsApp.main.stats.detail",{url:"/detail/:magnetName",templateUrl:"views/detail.tpl.html",controller:"ModalViewController"}).state("trrntsApp.main.billboard",{url:"/billboard",templateUrl:"views/billboard.tpl.html",controller:"BillboardViewController"})}]),angular.module("trrntsApp.services",[]).factory("BillboardDataFactory",function(){var a=function(){return[{key:"Box Office Revenue",values:[["Dawn Of The Planet Of The Apes",363e5],["The Purge: Anarchy",298e5],["Planes: Fire And Rescue",175e5],["Sex Tape",146e5],["Transformers: Age of Extinction",98e5],["Tammy",74e5],["22 Jump Street",47e5],["How to Train Your Dragon 2",39e5],["Earth to Echo",33e5],["Maleficent",32e5]]},{key:"Box Office Revenue",values:[["Dawn Of The Planet Of The Apes",36300],["The Purge: Anarchy",2980],["Planes: Fire And Rescue",1100],["Sex Tape",14600],["Transformers: Age of Extinction",98e3],["Tammy",7410],["22 Jump Street",47e3],["How to Train Your Dragon 2",39e4],["Earth to Echo",300],["Maleficent",32e3]]}]};return{getData:a}}).factory("MagnetLinksFactory",["$http","$q",function(a,b){var c=function(b){return a({method:"POST",url:"/api/magnets",data:{magnetURI:b}})},d=function(b,c){return a({method:"GET",url:"api/magnets/latest",params:{start:b||1,stop:c||30}})},e=function(b,c){return a({method:"GET",url:"api/magnets/top",params:{start:b||1,stop:c||30}})},f=function(c){return"string"!=typeof c?b.defer().promise:a({method:"GET",url:"api/magnets",params:{query:c}})},g=function(){return a({method:"GET",url:"api/magnets/topTen"}).then(function(a){var b=new DOMParser;a=b.parseFromString(a.data,"text/html");var c=a.getElementsByClassName("movie_list top_box_office"),d=c[0].getElementsByClassName("right_col"),e=c[0].getElementsByClassName("middle_col");a=[];for(var f=0;f<e.length;f++){var g={title:e[f].childNodes[1].textContent,revenue:d[f].textContent.slice(d[f].textContent.indexOf("$"),d[f].textContent.indexOf("M")+1)};a.push(g)}return a})};return{create:c,latest:d,top:e,search:f,topTen:g}}]).factory("SharedService",["$rootScope",function(a){var b={};return b.selectedMagnet="default",b.prepForBroadcast=function(a){this.selectedMagnet=a,this.broadcastItem()},b.broadcastItem=function(){a.$broadcast("handleBroadcast")},b}]).factory("GeoFactory",["$http",function(a){var b=function(b){return a({method:"GET",url:"api/locations",params:{query:"LatAndLong",number:b}})},c=function(b){return a({method:"GET",url:"api/locations",params:{query:"Country",number:b}})},d=function(b){return a({method:"GET",url:"api/locations",params:{query:"City",number:b}})};return{getLatAndLong:b,getCountries:c,getCities:d}}]);
//# sourceMappingURL=main.min.js.map